#+title: Trash


* mail

** account
#+begin_src emacs-lisp 
  (load-file "~/.emacs.d/private.el")



  (setq gnus-select-method
        '(nnimap "zoho"
                 (nnimap-address "imappro.zoho.com")
                 (nnimap-server-port 993)
                 (nnimap-stream ssl)
                 ;; (nnmail-expiry-target "zoho/Trash")
                 ;; (nnmail-expiry-wait 90)
                 ))


  (setq smtpmail-smtp-server "smtppro.zoho.com"
        smtpmail-smtp-service 465
        smtpmail-stream-type 'ssl
        ;; smtpmail-stream-type 'starttls
        )

  (setq gnus-secondary-select-methods
        '((nntp "gwene"
                (nntp-address "news.gwene.org"))
          (nnrss "")))

  ;; (add-to-list 'gnus-secondary-select-methods
  ;;              '(nnimap "sysu"
  ;;                       (nnimap-address "imap.exmail.qq.com")
  ;;                       (nnimap-user (getenv "SYSU_USER"))
  ;;                       (nnimap-server-port 993)
  ;;                       (nnimap-stream ssl)
  ;;                       ; @see http://www.gnu.org/software/emacs/manual/html_node/gnus/Expiring-Mail.html
  ;;                       ;; press 'E' to expire email
  ;;                       ;; (nnmail-expiry-target "nnimap+gmail:[Gmail]/Trash")
  ;;                       ;; (nnmail-expiry-wait 90)
  ;;                       ))

  ;; (setq gnus-posting-styles
  ;;       '(("sysu"
  ;;          (address (getenv "SYSU_USER"))
  ;;          (gnus-message-headers "From: user2@example.com\n")
  ;;          (organization "")
  ;;          (smtp-server "smtp.exmail.qq.com"))
  ;;         ("zoho"
  ;;          (address (getenv "ZOZHO_USER"))
  ;;          (gnus-message-headers "From: user1@example.com\n")
  ;;          (organization "")
  ;;          (smtp-server "smtppro.zoho.com"))))

  (setq message-send-mail-function 'smtpmail-send-it)
#+end_src

** basic 

#+begin_src elisp
  (setq epa-file-cache-passphrase-for-symmetric-encryption t)
  ;; (setq gnus-summary-ignore-most-enemies nil)
  ;; (setq gnus-permanently-visible-groups ".*")  
  ;; (setq gnus-use-followup-to t)
  ;; (setq gnus-check-new-newsgroups nil)  

  (setq gnus-use-cache t)

  (setq gnus-thread-sort-functions
        '(gnus-thread-sort-by-most-recent-date
          (not gnus-thread-sort-by-number)))

  ;; Fetch only part of the article if we can.
  ;; I saw this in someone's .gnus
  (setq gnus-read-active-file 'some)

  (add-hook 'gnus-group-mode-hook 'gnus-topic-mode)


  ;; Threads!  I hate reading un-threaded email -- especially mailing
  ;; lists.  This helps a ton!
  (setq gnus-summary-thread-gathering-function 'gnus-gather-threads-by-subject)


  ;; Also, I prefer to see only the top level message.  If a message has
  ;; several replies or is part of a thread, only show the first message.
  ;; `gnus-thread-ignore-subject' will ignore the subject and
  ;; look at 'In-Reply-To:' and 'References:' headers.
  (setq gnus-thread-hide-subtree t)
  (setq gnus-thread-ignore-subject t)

  (setq gnus-use-correct-string-widths nil)

  (global-set-key (kbd "C-c o g") 'gnus)
#+end_src

** ui
#+begin_src elisp :tangle no
  (setq nnmail-split-methods
        '(("junk" "^From:.*Lars Ingebrigtsen")
          ("crazy" "^Subject:.*die\\|^Organization:.*flabby")
          ("other" "")))

  (setq gnus-summary-line-format "%U%R%z %~(max-right 18)Date: %~(pad-right 20)From: %s\n")
#+end_src

** hydra
#+begin_src elisp
  ;; @see https://github.com/redguardtoo/mastering-emacs-in-one-year-guide/blob/master/gnus-guide-en.org
  ;; gnus-group-mode
  (eval-after-load 'gnus-group
    '(progn
       (defhydra hydra-gnus-group (:color blue)
         "
  [_A_] Remote groups (A A) [_g_] Refresh
  [_L_] Local groups        [_\\^_] List servers
  [_c_] Mark all read       [_m_] Compose new mail
  [_G_] Search mails (G G) [_#_] Mark mail
  "
         ("A" gnus-group-list-active)
         ("L" gnus-group-list-all-groups)
         ("c" gnus-topic-catchup-articles)
         ("G" dianyou-group-make-nnir-group)
         ("g" gnus-group-get-new-news)
         ("^" gnus-group-enter-server-mode)
         ("m" gnus-group-new-mail)
         ("#" gnus-topic-mark-topic)
         ("q" nil))
       ;; y is not used by default
       (define-key gnus-group-mode-map "y" 'hydra-gnus-group/body)))

  ;; gnus-summary-mode
  (eval-after-load 'gnus-sum
    '(progn
       (defhydra hydra-gnus-summary (:color blue)
         "
  [_s_] Show thread   [_F_] Forward (C-c C-f)
  [_h_] Hide thread   [_e_] Resend (S D e)
  [_n_] Refresh (/ N) [_r_] Reply
  [_!_] Mail -> disk  [_R_] Reply with original
  [_d_] Disk -> mail  [_w_] Reply all (S w)
  [_c_] Read all      [_W_] Reply all with original (S W)
  [_#_] Mark          [_G_] Search mails
  "
         ("s" gnus-summary-show-thread)
         ("h" gnus-summary-hide-thread)
         ("n" gnus-summary-insert-new-articles)
         ("F" gnus-summary-mail-forward)
         ("!" gnus-summary-tick-article-forward)
         ("d" gnus-summary-put-mark-as-read-next)
         ("c" gnus-summary-catchup-and-exit)
         ("e" gnus-summary-resend-message-edit)
         ("R" gnus-summary-reply-with-original)
         ("r" gnus-summary-reply)
         ("W" gnus-summary-wide-reply-with-original)
         ("w" gnus-summary-wide-reply)
         ("#" gnus-topic-mark-topic)
         ("G" dianyou-group-make-nnir-group)
         ("q" nil))
       ;; y is not used by default
       (define-key gnus-summary-mode-map "y" 'hydra-gnus-summary/body)))

  ;; gnus-article-mode
  (eval-after-load 'gnus-art
    '(progn
       (defhydra hydra-gnus-article (:color blue)
         "
  [_o_] Save attachment        [_F_] Forward
  [_v_] Play video/audio       [_r_] Reply
  [_d_] CLI to download stream [_R_] Reply with original
  [_b_] Open external browser  [_w_] Reply all (S w)
  [_f_] Click link/button      [_W_] Reply all with original (S W)
  [_g_] Focus link/button
  "
         ("F" gnus-summary-mail-forward)
         ("r" gnus-article-reply)
         ("R" gnus-article-reply-with-original)
         ("w" gnus-article-wide-reply)
         ("W" gnus-article-wide-reply-with-original)
         ("o" gnus-mime-save-part)
         ("v" my-w3m-open-with-mplayer)
         ("d" my-w3m-download-rss-stream)
         ("b" my-w3m-open-link-or-image-or-url)
         ("f" w3m-lnum-follow)
         ("g" w3m-lnum-goto)
         ("q" nil))
       ;; y is not used by default
       (define-key gnus-article-mode-map "y" 'hydra-gnus-article/body)))

  ;; message-mode
  (eval-after-load 'message
    '(progn
       (defhydra hydra-message (:color blue)
    "
  [_c_] Complete mail address
  [_a_] Attach file
  [_s_] Send mail (C-c C-c)
  "
         ("c" counsel-bbdb-complete-mail)
         ("a" mml-attach-file)
         ("s" message-send-and-exit)
         ("i" dianyou-insert-email-address-from-received-mails)
         ("q" nil))))

  (defun message-mode-hook-hydra-setup ()
    (local-set-key (kbd "C-c C-y") 'hydra-message/body))
  (add-hook 'message-mode-hook 'message-mode-hook-hydra-setup)
#+end_src

** edbd
#+begin_src emacs-lisp
  ;; (add-hook 'message-mode-hook
  ;;           '(lambda ()
  ;;              (flyspell-mode t)
  ;;              (local-set-key (kbd "TAB") 'bbdb-complete-name)))

  ;; (add-to-list 'load-path "/where/you/place/bbdb/")
  ;; (require 'bbdb)
  ;; (bbdb-initialize 'message 'gnus 'sendmail)
  ;; (add-hook 'gnus-startup-hook 'bbdb-insinuate-gnus)
  ;; (setq bbdb/mail-auto-create-p t
  ;;       bbdb/news-auto-create-p t)

  (require 'ebdb)
  (require 'ebdb-gnus)
  (require 'ebdb-complete)

  (ebdb-complete-enable)

  (defun kz/ebdb-set-mail-from-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^From:.*" nil t)
            (replace-match (format "From: %s" str)))))))

  (defun kz/ebdb-set-mail-to-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^To:.*" nil t)
            (replace-match (format "To: %s" str)))))))

  (define-key message-mode-map (kbd "C-c e f") 'kz/ebdb-set-mail-from-address)
  (define-key message-mode-map (kbd "C-c e t") 'kz/ebdb-set-mail-to-address)
#+end_src

** other
#+begin_src emacs-lisp
  (eval-after-load 'gnus-topic
    '(progn
       (setq gnus-message-archive-group '((format-time-string "sent.%Y")))
       (setq gnus-server-alist '(("archive" nnfolder "archive" (nnfolder-directory "~/Mail/archive")
                                  (nnfolder-active-file "~/Mail/archive/active")
                                  (nnfolder-get-new-mail nil)
                                  (nnfolder-inhibit-expiry t))))

       ;; "Gnus" is the root folder, and there are three mail accounts, "misc", "hotmail", "gmail"
       (setq gnus-topic-topology '(("Gnus" visible)
                                   (("Zoho" visible))
                                   (("News" visible))
                                   (("misc" visible))
                                   ;; (("gmail" visible nil nil))
                                   ))

       ;; each topic corresponds to a public imap folder
       (setq gnus-topic-alist '(("Zoho" ; the key of topic
                                 "INBOX"
                                 "Notification"
                                 "Archive"
                                 "Drafts"
                                 "Sent"
                                 "Spam"
                                 "Trash"
                                 "Drafts"
                                 "Newsletter"
                                 "Templates")
                                ;; ("gmail" ; the key of topic
                                ;;  "nnimap+gmail:INBOX"
                                ;;  "nnimap+gmail:[Gmail]/Sent Mail"
                                ;;  "nnimap+gmail:[Gmail]/Trash"
                                ;;  "nnimap+gmail:Drafts")
                                ("misc" ; the key of topic
                                 "nntp+gwene:gwene.com.stackoverflow.feeds.tag.emacs"
                                 "nntp+gwene:gwene.net.systemcrafters.rss.news"
                                 "nnrss:NYT > Technology"
                                 "nndraft:drafts")
                                ("News"
                                 "nnrss:Debian News"
)
                                ("Gnus")))

       ;; see latest 200 mails in topic hen press Enter on any group
       (gnus-topic-set-parameters "zoho" '((display . 200)))
       ;; (gnus-topic-set-parameters "hotmail" '((display . 200)))
       ))
#+end_src

** rss
#+begin_src elisp
  (setq nnrss-directory "~/News/rss")

  (setq nnrss-group-urls
        '(("Debian Latest News" "https://www.debian.org/News/news")
          ("Econ arXiv" "https://rss.arxiv.org/rss/econ")
          ("Q-fin arXiv" "https://rss.arxiv.org/rss/q-fin")
          ("Stat arXiv" "https://rss.arxiv.org/rss/stat")
          ("CS arXiv" "https://rss.arxiv.org/rss/cs")))
#+end_src
** END

* fingertip
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-fingertip.el
:END:

#+begin_src emacs-lisp
  (require 'fingertip)

  (dolist (hook (list
                 'bash-ts-mode-hook
                 'c++-mode-hook
                 'c++-ts-mode-hook
                 'c-mode-common-hook
                 'c-mode-hook
                 'c-ts-mode-hook
                 'cmake-ts-mode-hook
                 'coffee-mode-hook
                 'conf-toml-mode-hook
                 'css-mode-hook
                 'css-ts-mode-hook
                 'emacs-lisp-mode-hook
                 'go-mode-hook
                 'haskell-mode-hook
                 'ielm-mode-hook
                 'jade-mode-hook
                 'java-mode-hook
                 'js-mode-hook
                 'js-ts-mode-hook
                 'json-ts-mode-hook
                 'kotlin-mode-hook
                 'lisp-interaction-mode-hook
                 'lisp-mode-hook
                 'llvm-mode-hook
                 'lua-mode-hook
                 'makefile-gmake-mode-hook
                 'markdown-ts-mode-hook
                 'maxima-mode-hook
                 'mojo-mode-hook
                 'nim-mode-hook
                 'php-mode-hook
                 'php-ts-mode-hook
                 'python-mode-hook
                 'python-ts-mode-hook
                 'qmake-mode-hook
                 'qml-mode-hook
                 'ruby-mode-hook
                 'rust-mode-hook
                 'rust-ts-mode-hook
                 'sh-mode-hook
                 'swift-mode-hook
                 'toml-ts-mode-hook
                 'typescript-mode-hook
                 'typescript-ts-mode-hook
                 'web-mode-hook
                 'zig-mode-hook
                 'fsharp-mode-hook
                 'clojure-mode-hook
                 'clojure-ts-mode-hook
                 'cider-repl-mode-hook
                 'nix-mode-hook
                 'solidity-mode-hook
                 ))
    (add-hook hook #'(lambda ()
                       (when (or
                              (not (buffer-file-name))
                              (not (string-equal (file-name-extension (buffer-file-name)) "chat")))
                         (fingertip-mode 1)))
              ))

  (define-key fingertip-mode-map (kbd "(") 'fingertip-open-round)
  (define-key fingertip-mode-map (kbd "[") 'fingertip-open-bracket)
  (define-key fingertip-mode-map (kbd "{") 'fingertip-open-curly)
  ;; (define-key fingertip-mode-map (kbd ")") 'fingertip-close-round)
  (define-key fingertip-mode-map (kbd "]") 'fingertip-close-bracket)
  (define-key fingertip-mode-map (kbd "}") 'fingertip-close-curly)
  (define-key fingertip-mode-map (kbd "=") 'fingertip-equal)

  (define-key fingertip-mode-map (kbd "（") 'fingertip-open-chinese-round)
  (define-key fingertip-mode-map (kbd "「") 'fingertip-open-chinese-bracket)
  (define-key fingertip-mode-map (kbd "【") 'fingertip-open-chinese-curly)
  (define-key fingertip-mode-map (kbd "）") 'fingertip-close-chinese-round)
  (define-key fingertip-mode-map (kbd "」") 'fingertip-close-chinese-bracket)
  (define-key fingertip-mode-map (kbd "】") 'fingertip-close-chinese-curly)

  (define-key fingertip-mode-map (kbd "%") 'fingertip-match-paren)
  (define-key fingertip-mode-map (kbd "\"") 'fingertip-double-quote)
  (define-key fingertip-mode-map (kbd "'") 'fingertip-single-quote)

  (define-key fingertip-mode-map (kbd "SPC") 'fingertip-space)
  (define-key fingertip-mode-map (kbd "RET") 'fingertip-newline)

  ;; (define-key fingertip-mode-map (kbd "M-o") 'backward-delete-char)
  ;; (define-key fingertip-mode-map (kbd "M-O") 'backward-kill-word)
  (define-key fingertip-mode-map (kbd "C-k") 'fingertip-kill)

  ;; ???
  (define-key fingertip-mode-map (kbd "M-\"") 'fingertip-wrap-double-quote)
  (define-key fingertip-mode-map (kbd "M-'") 'fingertip-wrap-single-quote)
  (define-key fingertip-mode-map (kbd "M-[") 'fingertip-wrap-bracket)
  (define-key fingertip-mode-map (kbd "M-{") 'fingertip-wrap-curly)
  (define-key fingertip-mode-map (kbd "M-(") 'fingertip-wrap-round)
  (define-key fingertip-mode-map (kbd "M-)") 'fingertip-unwrap)

  ;; (define-key fingertip-mode-map (kbd "M-n") 'fingertip-jump-right)
  ;; (define-key fingertip-mode-map (kbd "M-p") 'fingertip-jump-left)
  (define-key fingertip-mode-map (kbd "C-M-;") 'fingertip-jump-out-pair-and-newline)
  (define-key fingertip-mode-map (kbd "M-p") 'fingertip-jump-up)

  (provide 'init-fingertip)
#+end_src

* meow

*** layout
#+begin_src elisp
  (defun meow-setup ()
    (setq meow-cheatsheet-layout meow-cheatsheet-layout-qwerty)
    (meow-motion-define-key
     '("j" . meow-next)
     '("k" . meow-prev)
     '("<escape>" . ignore))
    (meow-leader-define-key
     ;; Use SPC (0-9) for digit arguments.
     '("1" . meow-digit-argument)
     '("2" . meow-digit-argument)
     '("3" . meow-digit-argument)
     '("4" . meow-digit-argument)
     '("5" . meow-digit-argument)
     '("6" . meow-digit-argument)
     '("7" . meow-digit-argument)
     '("8" . meow-digit-argument)
     '("9" . meow-digit-argument)
     '("0" . meow-digit-argument)
     '("/" . meow-keypad-describe-key)
     '("?" . meow-cheatsheet))
    (meow-normal-define-key
     '("0" . meow-expand-0)
     '("9" . meow-expand-9)
     '("8" . meow-expand-8)
     '("7" . meow-expand-7)
     '("6" . meow-expand-6)
     '("5" . meow-expand-5)
     '("4" . meow-expand-4)
     '("3" . meow-expand-3)
     '("2" . meow-expand-2)
     '("1" . meow-expand-1)
     '("-" . negative-argument)
     '(";" . meow-reverse)
     '("," . meow-inner-of-thing)
     '("." . meow-bounds-of-thing)
     '("[" . meow-beginning-of-thing)
     '("]" . meow-end-of-thing)
     '("a" . meow-append)
     '("A" . meow-open-below)
     '("b" . meow-back-word)
     '("B" . meow-back-symbol)
     '("c" . meow-change)
     '("d" . meow-delete)
     '("D" . meow-backward-delete)
     '("e" . meow-next-word)
     '("E" . meow-next-symbol)
     '("f" . meow-find)
     '("g" . meow-cancel-selection)
     '("G" . meow-grab)
     '("h" . meow-left)
     '("H" . meow-left-expand)
     '("i" . meow-insert)
     '("I" . meow-open-above)
     '("j" . meow-next)
     '("J" . meow-next-expand)
     '("k" . meow-prev)
     '("K" . meow-prev-expand)
     '("l" . meow-right)
     '("L" . meow-right-expand)
     '("m" . meow-join)
     '("n" . meow-search)
     '("o" . meow-block)
     '("O" . meow-to-block)
     '("p" . meow-yank)
     '("q" . meow-quit)
     '("Q" . meow-goto-line)
     '("r" . meow-replace)
     '("R" . meow-swap-grab)
     '("s" . meow-kill)
     '("t" . meow-till)
     '("u" . meow-undo)
     '("U" . meow-undo-in-selection)
     '("v" . meow-visit)
     '("w" . meow-mark-word)
     '("W" . meow-mark-symbol)
     '("x" . meow-line)
     '("X" . meow-goto-line)
     '("y" . meow-save)
     '("Y" . meow-sync-grab)
     '("z" . meow-pop-selection)
     '("'" . repeat)
     '("<escape>" . ignore)))
#+end_src

*** new layout
#+begin_src elisp
  ;; C-x o fail 
  ;; x and m is very important w
  ;; meow line meow go line
  ;; meow join
  ;; mark word and symbol
  ;; till and find
  ;; pop select go back
  ;; I don't know how to use grab
  ;; search and find
  (defun meow-setup ()
    (setq meow-cheatsheet-layout meow-cheatsheet-layout-qwerty)
    (meow-motion-define-key
     '("n" . meow-next) ;; expand
     '("p" . meow-prev) ;
     '("<escape>" . ignore))
    (meow-leader-define-key
     ;; Use SPC (0-9) for digit arguments.
     '("1" . meow-digit-argument)
     '("2" . meow-digit-argument)
     '("3" . meow-digit-argument)
     '("4" . meow-digit-argument)
     '("5" . meow-digit-argument)
     '("6" . meow-digit-argument)
     '("7" . meow-digit-argument)
     '("8" . meow-digit-argument)
     '("9" . meow-digit-argument)
     '("0" . meow-digit-argument)
     '("/" . meow-keypad-describe-key)
     ;; '("?" . meow-cheatsheet))
    (meow-normal-define-key
     '("0" . meow-expand-0)
     '("9" . meow-expand-9)
     '("8" . meow-expand-8)
     '("7" . meow-expand-7)
     '("6" . meow-expand-6)
     '("5" . meow-expand-5)
     '("4" . meow-expand-4)
     '("3" . meow-expand-3)
     '("2" . meow-expand-2)
     '("1" . meow-expand-1)
     '("u" . negative-argument) ;
     '(";" . meow-reverse) ; x/u
     '("," . meow-inner-of-thing)
     '("." . meow-bounds-of-thing)
     '("[" . meow-beginning-of-thing)
     '("]" . meow-end-of-thing)
     '("a" . meow-append) ;
     '("m" . meow-open-below) ;
     '("b" . meow-back-word)
     '("B" . meow-back-symbol)
     ;; '("c" . meow-change)
     '("d" . meow-delete)
     ; '("D" . meow-backward-delete) ?o
     '("f" . meow-next-word) ;
     '("F" . meow-next-symbol)
     '("s" . meow-find) ;
     '("g" . meow-cancel-selection) ;
     ;; '("G" . meow-grab)
     ;; '("b" . meow-left) ;
     ;; '("B" . meow-left-expand) ;
     '("i" . meow-insert) ;
     '("o" . meow-open-above) ;
     '("n" . meow-next) ;
     '("N" . meow-next-expand) ;
     '("p" . meow-prev) ;
     '("P" . meow-prev-expand) ;
     ;; '("f" . meow-right)
     ;; '("F" . meow-right-expand) ;
     '("m" . meow-join)
     '("s" . meow-search) ;
     ;; '("o" . meow-block)
     ;; '("O" . meow-to-block)
     '("y" . meow-yank) ;
     '("q" . meow-quit)
     ;; '("Q" . meow-goto-line)
     '("r" . meow-replace)
     '("R" . meow-swap-grab)
     '("k" . meow-kill) ;
     '("t" . meow-till)
     '("/" . meow-undo) ;
     '("?" . meow-undo-in-selection) ;
     '("v" . meow-visit)
     '("w" . meow-mark-word)
     '("W" . meow-mark-symbol)
     '("a" . meow-line)
     '("A" . meow-goto-line)
     ;; '("w" . meow-save) ;
     '("Y" . meow-sync-grab)
     ;; '("z" . meow-pop-selection)
     '("'" . repeat)
     '("<escape>" . ignore)))
#+end_src

*** config
#+begin_src elisp
  (require 'meow)
  (meow-setup)
  (meow-global-mode nil)
#+end_src
* dape
#+begin_src elisp
  (require 'dape)
  (setq read-process-output-max (* 1024 1024)) ;; 1mb
  (setq gc-cons-threshold 80000000) ;; original value * 100
#+end_src
* eaf
#+begin_src elisp
  (require 'eaf)
  (require 'eaf-browser)
  (require 'eaf-jupyter)
  ;; (require 'eaf-pdf-viewer)
  (require 'eaf-video-player)

  (setq eaf-webengine-default-zoom 1.25)
  (global-set-key (kbd "C-c o b") 'eaf-open-browser-with-history)
  (global-set-key (kbd "C-c o j") 'eaf-open-jupyter)
  (global-set-key (kbd "C-c o r") 'eaf-open-rss-reader)

  (setq eaf-browser-chrome-browser-name "Chromium")
  (setq eaf-browser-auto-import-chrome-cookies t)
  (setq eaf-chrome-bookmark-file "~/.config/chromium/Default/Bookmarks")

  (setq eaf-python-command "~/.emacs.d/eaf-env/.venv/bin/python")
#+end_src

* clone
** lsp bridge
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-lsp-bridge.el
:END:
#+begin_src emacs-lisp
  (add-to-list 'load-path "~/.emacs.d/lib/lsp-bridge/")
  (require 'lsp-bridge)
  (require 'lsp-bridge-jdtls)

  ;;; Code:
  ;; (add-hook 'find-file-hook #'lsp-bridge-restart-process)
  ;; (add-hook 'org-edit-special-hook #'lsp-bridge-restart-process)

  (setq lsp-bridge-enable-completion-in-minibuffer t)
  ;; (setq lsp-bridge-python-command "uv run python3")
  (setq lsp-bridge-python-command (expand-file-name "~/.emacs.d/lsp-bridge-env/.venv/bin/python3"))
  ;; (setq lsp-pyright-langserver-command "~/.emacs.d/lsp-bridge-env/.venv/bin/python3 -m basedpyright")
  (setq lsp-bridge-enable-auto-import t)
  (setq lsp-bridge-signature-show-function 'lsp-bridge-signature-show-with-frame)
  (setq lsp-bridge-enable-with-tramp t)
  (setq lsp-bridge-enable-org-babel nil)
  (setq acm-enable-capf t)
  (setq acm-enable-quick-access t)
  (setq acm-backend-yas-match-by-trigger-keyword t)
  (setq acm-enable-tabnine nil)
  (setq acm-enable-codeium nil)
  (setq acm-enable-lsp-workspace-symbol t)
  (setq lsp-bridge-enable-inlay-hint t)
  (setq lsp-bridge-semantic-tokens t)
  (setq-default lsp-bridge-semantic-tokens-ignore-modifier-limit-types ["variable"])

  (global-lsp-bridge-mode)

  (add-to-list 'lsp-bridge-multi-lang-server-extension-list '(("html") . "html_tailwindcss"))
  (add-to-list 'lsp-bridge-multi-lang-server-extension-list '(("css") . "css_tailwindcss"))

  (setq lsp-bridge-csharp-lsp-server "csharp-ls")
  (setq lsp-bridge-nix-lsp-server "nil")

  ;; 打开日志，开发者才需要
  ;; (setq lsp-bridge-enable-log t)

  (setq lsp-bridge-get-multi-lang-server-by-project
        (lambda (project-path filepath)
          ;; If typescript file include deno.land url, then use Deno LSP server.
          (save-excursion
            (when (string-equal (file-name-extension filepath) "ts")
              (dolist (buf (buffer-list))
                (when (string-equal (buffer-file-name buf) filepath)
                  (with-current-buffer buf
                    (goto-char (point-min))
                    (when (search-forward-regexp (regexp-quote "from \"https://deno.land") nil t)
                      (return "deno")))))))))

  (global-set-key (kbd "C-c l f") 'lsp-bridge-find-def)
  (global-set-key (kbd "C-c l F") 'lsp-bridge-find-def-other-window)
  (global-set-key (kbd "C-c l r") 'lsp-bridge-find-def-return)
  (global-set-key (kbd "C-c l R") 'lsp-bridge-find-find-references)

  (provide 'init-lsp-bridge)
#+end_src
* mail
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-mail.el
:END:

** account
#+begin_src elisp
  ;; (require 'private)
  (setq user-mail-address "hello@kazurezheng.xyz")

  (setq smtpmail-smtp-server "smtppro.zoho.com"
        smtpmail-smtp-service 465
        smtpmail-stream-type 'ssl
        ;; smtpmail-stream-type 'starttls
        )

  (setq send-mail-function 'smtpmail-send-it)
  ;; (setq mail-user-agent 'sendmail-user-agent)
  (setq mail-user-agent 'mu4e-user-agent)
  (setq mu4e-compose-in-reply-to-function #'mu4e-compose-in-reply-to-function)
#+end_src

** mu4e
#+begin_src elisp
  ;; (add-to-list 'load-path "~/.emacs.d/lib/mu4e/mu4e")
  (require 'mu4e)

  (setq mu4e-notification-support t)
  (setq mu4e-eldoc-support t)

  (global-set-key (kbd "C-c n C") 'mu4e-org-store-and-capture)
  ;; Show images
  (setq mu4e-show-images t)

  ;; Use fancy chars
  (setq mu4e-use-fancy-chars t)

  ;; This is set to 't' to avoid mail syncing issues when using mbsync
  (setq mu4e-change-filenames-when-moving t)

  ;; Refresh mail using isync every 10 minutes
  (setq mu4e-update-interval (* 10 60))
  (setq mu4e-get-mail-command "mbsync -a")
  (setq mu4e-maildir "~/Mail")

  (setq mu4e-drafts-folder "/Drafts")
  (setq mu4e-sent-folder   "/Sent")
  (setq mu4e-refile-folder "/Archive")
  (setq mu4e-trash-folder  "/Trash")

  ;; (setq mu4e-maildir-shortcuts
  ;;       '(("/Inbox"             . ?i)
  ;;         ("/[Gmail]/Sent Mail" . ?s)
  ;;         ("/[Gmail]/Trash"     . ?t)
  ;;         ("/[Gmail]/Drafts"    . ?d)
  ;;         ("/[Gmail]/All Mail"  . ?a)))

  (setq mu4e-get-mail-command "mbsync -a")  ; or offlineimap, isync, etc.
  (setq mu4e-update-interval 300)  ; Update every 5 minutes
  (global-set-key  (kbd "C-c o m") 'mu4e)
#+end_src
** edbd
#+begin_src emacs-lisp
  ;; (add-hook 'message-mode-hook
  ;;           '(lambda ()
  ;;              (flyspell-mode t)
  ;;              (local-set-key (kbd "TAB") 'bbdb-complete-name)))

  ;; (add-to-list 'load-path "/where/you/place/bbdb/")
  ;; (require 'bbdb)
  ;; (bbdb-initialize 'message 'gnus 'sendmail)
  ;; (add-hook 'gnus-startup-hook 'bbdb-insinuate-gnus)
  ;; (setq bbdb/mail-auto-create-p t
  ;;       bbdb/news-auto-create-p t)

  (require 'ebdb)
  (require 'ebdb-mu4e)
  (require 'ebdb-complete)

  (ebdb-complete-enable)

  (defun kz/ebdb-set-mail-from-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^From:.*" nil t)
            (replace-match (format "From: %s" str)))))))

  (defun kz/ebdb-set-mail-to-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^To:.*" nil t)
            (replace-match (format "To: %s" str)))))))

  (define-key message-mode-map (kbd "C-c e f") 'kz/ebdb-set-mail-from-address)
  (define-key message-mode-map (kbd "C-c e t") 'kz/ebdb-set-mail-to-address)
#+end_src

