#+title: Trash


* mail

** account
#+begin_src emacs-lisp 
  (load-file "~/.emacs.d/private.el")



  (setq gnus-select-method
        '(nnimap "zoho"
                 (nnimap-address "imappro.zoho.com")
                 (nnimap-server-port 993)
                 (nnimap-stream ssl)
                 ;; (nnmail-expiry-target "zoho/Trash")
                 ;; (nnmail-expiry-wait 90)
                 ))


  (setq smtpmail-smtp-server "smtppro.zoho.com"
        smtpmail-smtp-service 465
        smtpmail-stream-type 'ssl
        ;; smtpmail-stream-type 'starttls
        )

  (setq gnus-secondary-select-methods
        '((nntp "gwene"
                (nntp-address "news.gwene.org"))
          (nnrss "")))

  ;; (add-to-list 'gnus-secondary-select-methods
  ;;              '(nnimap "sysu"
  ;;                       (nnimap-address "imap.exmail.qq.com")
  ;;                       (nnimap-user (getenv "SYSU_USER"))
  ;;                       (nnimap-server-port 993)
  ;;                       (nnimap-stream ssl)
  ;;                       ; @see http://www.gnu.org/software/emacs/manual/html_node/gnus/Expiring-Mail.html
  ;;                       ;; press 'E' to expire email
  ;;                       ;; (nnmail-expiry-target "nnimap+gmail:[Gmail]/Trash")
  ;;                       ;; (nnmail-expiry-wait 90)
  ;;                       ))

  ;; (setq gnus-posting-styles
  ;;       '(("sysu"
  ;;          (address (getenv "SYSU_USER"))
  ;;          (gnus-message-headers "From: user2@example.com\n")
  ;;          (organization "")
  ;;          (smtp-server "smtp.exmail.qq.com"))
  ;;         ("zoho"
  ;;          (address (getenv "ZOZHO_USER"))
  ;;          (gnus-message-headers "From: user1@example.com\n")
  ;;          (organization "")
  ;;          (smtp-server "smtppro.zoho.com"))))

  (setq message-send-mail-function 'smtpmail-send-it)
#+end_src

** basic 

#+begin_src elisp
  (setq epa-file-cache-passphrase-for-symmetric-encryption t)
  ;; (setq gnus-summary-ignore-most-enemies nil)
  ;; (setq gnus-permanently-visible-groups ".*")  
  ;; (setq gnus-use-followup-to t)
  ;; (setq gnus-check-new-newsgroups nil)  

  (setq gnus-use-cache t)

  (setq gnus-thread-sort-functions
        '(gnus-thread-sort-by-most-recent-date
          (not gnus-thread-sort-by-number)))

  ;; Fetch only part of the article if we can.
  ;; I saw this in someone's .gnus
  (setq gnus-read-active-file 'some)

  (add-hook 'gnus-group-mode-hook 'gnus-topic-mode)


  ;; Threads!  I hate reading un-threaded email -- especially mailing
  ;; lists.  This helps a ton!
  (setq gnus-summary-thread-gathering-function 'gnus-gather-threads-by-subject)


  ;; Also, I prefer to see only the top level message.  If a message has
  ;; several replies or is part of a thread, only show the first message.
  ;; `gnus-thread-ignore-subject' will ignore the subject and
  ;; look at 'In-Reply-To:' and 'References:' headers.
  (setq gnus-thread-hide-subtree t)
  (setq gnus-thread-ignore-subject t)

  (setq gnus-use-correct-string-widths nil)

  (global-set-key (kbd "C-c o g") 'gnus)
#+end_src

** ui
#+begin_src elisp :tangle no
  (setq nnmail-split-methods
        '(("junk" "^From:.*Lars Ingebrigtsen")
          ("crazy" "^Subject:.*die\\|^Organization:.*flabby")
          ("other" "")))

  (setq gnus-summary-line-format "%U%R%z %~(max-right 18)Date: %~(pad-right 20)From: %s\n")
#+end_src

** hydra
#+begin_src elisp
  ;; @see https://github.com/redguardtoo/mastering-emacs-in-one-year-guide/blob/master/gnus-guide-en.org
  ;; gnus-group-mode
  (eval-after-load 'gnus-group
    '(progn
       (defhydra hydra-gnus-group (:color blue)
         "
  [_A_] Remote groups (A A) [_g_] Refresh
  [_L_] Local groups        [_\\^_] List servers
  [_c_] Mark all read       [_m_] Compose new mail
  [_G_] Search mails (G G) [_#_] Mark mail
  "
         ("A" gnus-group-list-active)
         ("L" gnus-group-list-all-groups)
         ("c" gnus-topic-catchup-articles)
         ("G" dianyou-group-make-nnir-group)
         ("g" gnus-group-get-new-news)
         ("^" gnus-group-enter-server-mode)
         ("m" gnus-group-new-mail)
         ("#" gnus-topic-mark-topic)
         ("q" nil))
       ;; y is not used by default
       (define-key gnus-group-mode-map "y" 'hydra-gnus-group/body)))

  ;; gnus-summary-mode
  (eval-after-load 'gnus-sum
    '(progn
       (defhydra hydra-gnus-summary (:color blue)
         "
  [_s_] Show thread   [_F_] Forward (C-c C-f)
  [_h_] Hide thread   [_e_] Resend (S D e)
  [_n_] Refresh (/ N) [_r_] Reply
  [_!_] Mail -> disk  [_R_] Reply with original
  [_d_] Disk -> mail  [_w_] Reply all (S w)
  [_c_] Read all      [_W_] Reply all with original (S W)
  [_#_] Mark          [_G_] Search mails
  "
         ("s" gnus-summary-show-thread)
         ("h" gnus-summary-hide-thread)
         ("n" gnus-summary-insert-new-articles)
         ("F" gnus-summary-mail-forward)
         ("!" gnus-summary-tick-article-forward)
         ("d" gnus-summary-put-mark-as-read-next)
         ("c" gnus-summary-catchup-and-exit)
         ("e" gnus-summary-resend-message-edit)
         ("R" gnus-summary-reply-with-original)
         ("r" gnus-summary-reply)
         ("W" gnus-summary-wide-reply-with-original)
         ("w" gnus-summary-wide-reply)
         ("#" gnus-topic-mark-topic)
         ("G" dianyou-group-make-nnir-group)
         ("q" nil))
       ;; y is not used by default
       (define-key gnus-summary-mode-map "y" 'hydra-gnus-summary/body)))

  ;; gnus-article-mode
  (eval-after-load 'gnus-art
    '(progn
       (defhydra hydra-gnus-article (:color blue)
         "
  [_o_] Save attachment        [_F_] Forward
  [_v_] Play video/audio       [_r_] Reply
  [_d_] CLI to download stream [_R_] Reply with original
  [_b_] Open external browser  [_w_] Reply all (S w)
  [_f_] Click link/button      [_W_] Reply all with original (S W)
  [_g_] Focus link/button
  "
         ("F" gnus-summary-mail-forward)
         ("r" gnus-article-reply)
         ("R" gnus-article-reply-with-original)
         ("w" gnus-article-wide-reply)
         ("W" gnus-article-wide-reply-with-original)
         ("o" gnus-mime-save-part)
         ("v" my-w3m-open-with-mplayer)
         ("d" my-w3m-download-rss-stream)
         ("b" my-w3m-open-link-or-image-or-url)
         ("f" w3m-lnum-follow)
         ("g" w3m-lnum-goto)
         ("q" nil))
       ;; y is not used by default
       (define-key gnus-article-mode-map "y" 'hydra-gnus-article/body)))

  ;; message-mode
  (eval-after-load 'message
    '(progn
       (defhydra hydra-message (:color blue)
    "
  [_c_] Complete mail address
  [_a_] Attach file
  [_s_] Send mail (C-c C-c)
  "
         ("c" counsel-bbdb-complete-mail)
         ("a" mml-attach-file)
         ("s" message-send-and-exit)
         ("i" dianyou-insert-email-address-from-received-mails)
         ("q" nil))))

  (defun message-mode-hook-hydra-setup ()
    (local-set-key (kbd "C-c C-y") 'hydra-message/body))
  (add-hook 'message-mode-hook 'message-mode-hook-hydra-setup)
#+end_src

** edbd
#+begin_src emacs-lisp
  ;; (add-hook 'message-mode-hook
  ;;           '(lambda ()
  ;;              (flyspell-mode t)
  ;;              (local-set-key (kbd "TAB") 'bbdb-complete-name)))

  ;; (add-to-list 'load-path "/where/you/place/bbdb/")
  ;; (require 'bbdb)
  ;; (bbdb-initialize 'message 'gnus 'sendmail)
  ;; (add-hook 'gnus-startup-hook 'bbdb-insinuate-gnus)
  ;; (setq bbdb/mail-auto-create-p t
  ;;       bbdb/news-auto-create-p t)

  (require 'ebdb)
  (require 'ebdb-gnus)
  (require 'ebdb-complete)

  (ebdb-complete-enable)

  (defun kz/ebdb-set-mail-from-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^From:.*" nil t)
            (replace-match (format "From: %s" str)))))))

  (defun kz/ebdb-set-mail-to-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^To:.*" nil t)
            (replace-match (format "To: %s" str)))))))

  (define-key message-mode-map (kbd "C-c e f") 'kz/ebdb-set-mail-from-address)
  (define-key message-mode-map (kbd "C-c e t") 'kz/ebdb-set-mail-to-address)
#+end_src

** other
#+begin_src emacs-lisp
  (eval-after-load 'gnus-topic
    '(progn
       (setq gnus-message-archive-group '((format-time-string "sent.%Y")))
       (setq gnus-server-alist '(("archive" nnfolder "archive" (nnfolder-directory "~/Mail/archive")
                                  (nnfolder-active-file "~/Mail/archive/active")
                                  (nnfolder-get-new-mail nil)
                                  (nnfolder-inhibit-expiry t))))

       ;; "Gnus" is the root folder, and there are three mail accounts, "misc", "hotmail", "gmail"
       (setq gnus-topic-topology '(("Gnus" visible)
                                   (("Zoho" visible))
                                   (("News" visible))
                                   (("misc" visible))
                                   ;; (("gmail" visible nil nil))
                                   ))

       ;; each topic corresponds to a public imap folder
       (setq gnus-topic-alist '(("Zoho" ; the key of topic
                                 "INBOX"
                                 "Notification"
                                 "Archive"
                                 "Drafts"
                                 "Sent"
                                 "Spam"
                                 "Trash"
                                 "Drafts"
                                 "Newsletter"
                                 "Templates")
                                ;; ("gmail" ; the key of topic
                                ;;  "nnimap+gmail:INBOX"
                                ;;  "nnimap+gmail:[Gmail]/Sent Mail"
                                ;;  "nnimap+gmail:[Gmail]/Trash"
                                ;;  "nnimap+gmail:Drafts")
                                ("misc" ; the key of topic
                                 "nntp+gwene:gwene.com.stackoverflow.feeds.tag.emacs"
                                 "nntp+gwene:gwene.net.systemcrafters.rss.news"
                                 "nnrss:NYT > Technology"
                                 "nndraft:drafts")
                                ("News"
                                 "nnrss:Debian News"
)
                                ("Gnus")))

       ;; see latest 200 mails in topic hen press Enter on any group
       (gnus-topic-set-parameters "zoho" '((display . 200)))
       ;; (gnus-topic-set-parameters "hotmail" '((display . 200)))
       ))
#+end_src

** rss
#+begin_src elisp
  (setq nnrss-directory "~/News/rss")

  (setq nnrss-group-urls
        '(("Debian Latest News" "https://www.debian.org/News/news")
          ("Econ arXiv" "https://rss.arxiv.org/rss/econ")
          ("Q-fin arXiv" "https://rss.arxiv.org/rss/q-fin")
          ("Stat arXiv" "https://rss.arxiv.org/rss/stat")
          ("CS arXiv" "https://rss.arxiv.org/rss/cs")))
#+end_src
** END

* fingertip
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-fingertip.el
:END:

#+begin_src emacs-lisp
  (require 'fingertip)

  (dolist (hook (list
                 'bash-ts-mode-hook
                 'c++-mode-hook
                 'c++-ts-mode-hook
                 'c-mode-common-hook
                 'c-mode-hook
                 'c-ts-mode-hook
                 'cmake-ts-mode-hook
                 'coffee-mode-hook
                 'conf-toml-mode-hook
                 'css-mode-hook
                 'css-ts-mode-hook
                 'emacs-lisp-mode-hook
                 'go-mode-hook
                 'haskell-mode-hook
                 'ielm-mode-hook
                 'jade-mode-hook
                 'java-mode-hook
                 'js-mode-hook
                 'js-ts-mode-hook
                 'json-ts-mode-hook
                 'kotlin-mode-hook
                 'lisp-interaction-mode-hook
                 'lisp-mode-hook
                 'llvm-mode-hook
                 'lua-mode-hook
                 'makefile-gmake-mode-hook
                 'markdown-ts-mode-hook
                 'maxima-mode-hook
                 'mojo-mode-hook
                 'nim-mode-hook
                 'php-mode-hook
                 'php-ts-mode-hook
                 'python-mode-hook
                 'python-ts-mode-hook
                 'qmake-mode-hook
                 'qml-mode-hook
                 'ruby-mode-hook
                 'rust-mode-hook
                 'rust-ts-mode-hook
                 'sh-mode-hook
                 'swift-mode-hook
                 'toml-ts-mode-hook
                 'typescript-mode-hook
                 'typescript-ts-mode-hook
                 'web-mode-hook
                 'zig-mode-hook
                 'fsharp-mode-hook
                 'clojure-mode-hook
                 'clojure-ts-mode-hook
                 'cider-repl-mode-hook
                 'nix-mode-hook
                 'solidity-mode-hook
                 ))
    (add-hook hook #'(lambda ()
                       (when (or
                              (not (buffer-file-name))
                              (not (string-equal (file-name-extension (buffer-file-name)) "chat")))
                         (fingertip-mode 1)))
              ))

  (define-key fingertip-mode-map (kbd "(") 'fingertip-open-round)
  (define-key fingertip-mode-map (kbd "[") 'fingertip-open-bracket)
  (define-key fingertip-mode-map (kbd "{") 'fingertip-open-curly)
  ;; (define-key fingertip-mode-map (kbd ")") 'fingertip-close-round)
  (define-key fingertip-mode-map (kbd "]") 'fingertip-close-bracket)
  (define-key fingertip-mode-map (kbd "}") 'fingertip-close-curly)
  (define-key fingertip-mode-map (kbd "=") 'fingertip-equal)

  (define-key fingertip-mode-map (kbd "（") 'fingertip-open-chinese-round)
  (define-key fingertip-mode-map (kbd "「") 'fingertip-open-chinese-bracket)
  (define-key fingertip-mode-map (kbd "【") 'fingertip-open-chinese-curly)
  (define-key fingertip-mode-map (kbd "）") 'fingertip-close-chinese-round)
  (define-key fingertip-mode-map (kbd "」") 'fingertip-close-chinese-bracket)
  (define-key fingertip-mode-map (kbd "】") 'fingertip-close-chinese-curly)

  (define-key fingertip-mode-map (kbd "%") 'fingertip-match-paren)
  (define-key fingertip-mode-map (kbd "\"") 'fingertip-double-quote)
  (define-key fingertip-mode-map (kbd "'") 'fingertip-single-quote)

  (define-key fingertip-mode-map (kbd "SPC") 'fingertip-space)
  (define-key fingertip-mode-map (kbd "RET") 'fingertip-newline)

  ;; (define-key fingertip-mode-map (kbd "M-o") 'backward-delete-char)
  ;; (define-key fingertip-mode-map (kbd "M-O") 'backward-kill-word)
  (define-key fingertip-mode-map (kbd "C-k") 'fingertip-kill)

  ;; ???
  (define-key fingertip-mode-map (kbd "M-\"") 'fingertip-wrap-double-quote)
  (define-key fingertip-mode-map (kbd "M-'") 'fingertip-wrap-single-quote)
  (define-key fingertip-mode-map (kbd "M-[") 'fingertip-wrap-bracket)
  (define-key fingertip-mode-map (kbd "M-{") 'fingertip-wrap-curly)
  (define-key fingertip-mode-map (kbd "M-(") 'fingertip-wrap-round)
  (define-key fingertip-mode-map (kbd "M-)") 'fingertip-unwrap)

  ;; (define-key fingertip-mode-map (kbd "M-n") 'fingertip-jump-right)
  ;; (define-key fingertip-mode-map (kbd "M-p") 'fingertip-jump-left)
  (define-key fingertip-mode-map (kbd "C-M-;") 'fingertip-jump-out-pair-and-newline)
  (define-key fingertip-mode-map (kbd "M-p") 'fingertip-jump-up)

  (provide 'init-fingertip)
#+end_src

* meow

*** layout
#+begin_src elisp
  (defun meow-setup ()
    (setq meow-cheatsheet-layout meow-cheatsheet-layout-qwerty)
    (meow-motion-define-key
     '("j" . meow-next)
     '("k" . meow-prev)
     '("<escape>" . ignore))
    (meow-leader-define-key
     ;; Use SPC (0-9) for digit arguments.
     '("1" . meow-digit-argument)
     '("2" . meow-digit-argument)
     '("3" . meow-digit-argument)
     '("4" . meow-digit-argument)
     '("5" . meow-digit-argument)
     '("6" . meow-digit-argument)
     '("7" . meow-digit-argument)
     '("8" . meow-digit-argument)
     '("9" . meow-digit-argument)
     '("0" . meow-digit-argument)
     '("/" . meow-keypad-describe-key)
     '("?" . meow-cheatsheet))
    (meow-normal-define-key
     '("0" . meow-expand-0)
     '("9" . meow-expand-9)
     '("8" . meow-expand-8)
     '("7" . meow-expand-7)
     '("6" . meow-expand-6)
     '("5" . meow-expand-5)
     '("4" . meow-expand-4)
     '("3" . meow-expand-3)
     '("2" . meow-expand-2)
     '("1" . meow-expand-1)
     '("-" . negative-argument)
     '(";" . meow-reverse)
     '("," . meow-inner-of-thing)
     '("." . meow-bounds-of-thing)
     '("[" . meow-beginning-of-thing)
     '("]" . meow-end-of-thing)
     '("a" . meow-append)
     '("A" . meow-open-below)
     '("b" . meow-back-word)
     '("B" . meow-back-symbol)
     '("c" . meow-change)
     '("d" . meow-delete)
     '("D" . meow-backward-delete)
     '("e" . meow-next-word)
     '("E" . meow-next-symbol)
     '("f" . meow-find)
     '("g" . meow-cancel-selection)
     '("G" . meow-grab)
     '("h" . meow-left)
     '("H" . meow-left-expand)
     '("i" . meow-insert)
     '("I" . meow-open-above)
     '("j" . meow-next)
     '("J" . meow-next-expand)
     '("k" . meow-prev)
     '("K" . meow-prev-expand)
     '("l" . meow-right)
     '("L" . meow-right-expand)
     '("m" . meow-join)
     '("n" . meow-search)
     '("o" . meow-block)
     '("O" . meow-to-block)
     '("p" . meow-yank)
     '("q" . meow-quit)
     '("Q" . meow-goto-line)
     '("r" . meow-replace)
     '("R" . meow-swap-grab)
     '("s" . meow-kill)
     '("t" . meow-till)
     '("u" . meow-undo)
     '("U" . meow-undo-in-selection)
     '("v" . meow-visit)
     '("w" . meow-mark-word)
     '("W" . meow-mark-symbol)
     '("x" . meow-line)
     '("X" . meow-goto-line)
     '("y" . meow-save)
     '("Y" . meow-sync-grab)
     '("z" . meow-pop-selection)
     '("'" . repeat)
     '("<escape>" . ignore)))
#+end_src

*** new layout
#+begin_src elisp
  ;; C-x o fail 
  ;; x and m is very important w
  ;; meow line meow go line
  ;; meow join
  ;; mark word and symbol
  ;; till and find
  ;; pop select go back
  ;; I don't know how to use grab
  ;; search and find
  (defun meow-setup ()
    (setq meow-cheatsheet-layout meow-cheatsheet-layout-qwerty)
    (meow-motion-define-key
     '("n" . meow-next) ;; expand
     '("p" . meow-prev) ;
     '("<escape>" . ignore))
    (meow-leader-define-key
     ;; Use SPC (0-9) for digit arguments.
     '("1" . meow-digit-argument)
     '("2" . meow-digit-argument)
     '("3" . meow-digit-argument)
     '("4" . meow-digit-argument)
     '("5" . meow-digit-argument)
     '("6" . meow-digit-argument)
     '("7" . meow-digit-argument)
     '("8" . meow-digit-argument)
     '("9" . meow-digit-argument)
     '("0" . meow-digit-argument)
     '("/" . meow-keypad-describe-key)
     ;; '("?" . meow-cheatsheet))
    (meow-normal-define-key
     '("0" . meow-expand-0)
     '("9" . meow-expand-9)
     '("8" . meow-expand-8)
     '("7" . meow-expand-7)
     '("6" . meow-expand-6)
     '("5" . meow-expand-5)
     '("4" . meow-expand-4)
     '("3" . meow-expand-3)
     '("2" . meow-expand-2)
     '("1" . meow-expand-1)
     '("u" . negative-argument) ;
     '(";" . meow-reverse) ; x/u
     '("," . meow-inner-of-thing)
     '("." . meow-bounds-of-thing)
     '("[" . meow-beginning-of-thing)
     '("]" . meow-end-of-thing)
     '("a" . meow-append) ;
     '("m" . meow-open-below) ;
     '("b" . meow-back-word)
     '("B" . meow-back-symbol)
     ;; '("c" . meow-change)
     '("d" . meow-delete)
     ; '("D" . meow-backward-delete) ?o
     '("f" . meow-next-word) ;
     '("F" . meow-next-symbol)
     '("s" . meow-find) ;
     '("g" . meow-cancel-selection) ;
     ;; '("G" . meow-grab)
     ;; '("b" . meow-left) ;
     ;; '("B" . meow-left-expand) ;
     '("i" . meow-insert) ;
     '("o" . meow-open-above) ;
     '("n" . meow-next) ;
     '("N" . meow-next-expand) ;
     '("p" . meow-prev) ;
     '("P" . meow-prev-expand) ;
     ;; '("f" . meow-right)
     ;; '("F" . meow-right-expand) ;
     '("m" . meow-join)
     '("s" . meow-search) ;
     ;; '("o" . meow-block)
     ;; '("O" . meow-to-block)
     '("y" . meow-yank) ;
     '("q" . meow-quit)
     ;; '("Q" . meow-goto-line)
     '("r" . meow-replace)
     '("R" . meow-swap-grab)
     '("k" . meow-kill) ;
     '("t" . meow-till)
     '("/" . meow-undo) ;
     '("?" . meow-undo-in-selection) ;
     '("v" . meow-visit)
     '("w" . meow-mark-word)
     '("W" . meow-mark-symbol)
     '("a" . meow-line)
     '("A" . meow-goto-line)
     ;; '("w" . meow-save) ;
     '("Y" . meow-sync-grab)
     ;; '("z" . meow-pop-selection)
     '("'" . repeat)
     '("<escape>" . ignore)))
#+end_src

*** config
#+begin_src elisp
  (require 'meow)
  (meow-setup)
  (meow-global-mode nil)
#+end_src
* dape
#+begin_src elisp
  (require 'dape)
  (setq read-process-output-max (* 1024 1024)) ;; 1mb
  (setq gc-cons-threshold 80000000) ;; original value * 100
#+end_src
* eaf
#+begin_src elisp
  (require 'eaf)
  (require 'eaf-browser)
  (require 'eaf-jupyter)
  ;; (require 'eaf-pdf-viewer)
  (require 'eaf-video-player)

  (setq eaf-webengine-default-zoom 1.25)
  (global-set-key (kbd "C-c o b") 'eaf-open-browser-with-history)
  (global-set-key (kbd "C-c o j") 'eaf-open-jupyter)
  (global-set-key (kbd "C-c o r") 'eaf-open-rss-reader)

  (setq eaf-browser-chrome-browser-name "Chromium")
  (setq eaf-browser-auto-import-chrome-cookies t)
  (setq eaf-chrome-bookmark-file "~/.config/chromium/Default/Bookmarks")

  (setq eaf-python-command "~/.emacs.d/eaf-env/.venv/bin/python")
#+end_src

* clone
** lsp bridge
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-lsp-bridge.el
:END:
#+begin_src emacs-lisp
  (add-to-list 'load-path "~/.emacs.d/lib/lsp-bridge/")
  (require 'lsp-bridge)
  (require 'lsp-bridge-jdtls)

  ;;; Code:
  ;; (add-hook 'find-file-hook #'lsp-bridge-restart-process)
  ;; (add-hook 'org-edit-special-hook #'lsp-bridge-restart-process)

  (setq lsp-bridge-enable-completion-in-minibuffer t)
  ;; (setq lsp-bridge-python-command "uv run python3")
  (setq lsp-bridge-python-command (expand-file-name "~/.emacs.d/lsp-bridge-env/.venv/bin/python3"))
  ;; (setq lsp-pyright-langserver-command "~/.emacs.d/lsp-bridge-env/.venv/bin/python3 -m basedpyright")
  (setq lsp-bridge-enable-auto-import t)
  (setq lsp-bridge-signature-show-function 'lsp-bridge-signature-show-with-frame)
  (setq lsp-bridge-enable-with-tramp t)
  (setq lsp-bridge-enable-org-babel nil)
  (setq acm-enable-capf t)
  (setq acm-enable-quick-access t)
  (setq acm-backend-yas-match-by-trigger-keyword t)
  (setq acm-enable-tabnine nil)
  (setq acm-enable-codeium nil)
  (setq acm-enable-lsp-workspace-symbol t)
  (setq lsp-bridge-enable-inlay-hint t)
  (setq lsp-bridge-semantic-tokens t)
  (setq-default lsp-bridge-semantic-tokens-ignore-modifier-limit-types ["variable"])

  (global-lsp-bridge-mode)

  (add-to-list 'lsp-bridge-multi-lang-server-extension-list '(("html") . "html_tailwindcss"))
  (add-to-list 'lsp-bridge-multi-lang-server-extension-list '(("css") . "css_tailwindcss"))

  (setq lsp-bridge-csharp-lsp-server "csharp-ls")
  (setq lsp-bridge-nix-lsp-server "nil")

  ;; 打开日志，开发者才需要
  ;; (setq lsp-bridge-enable-log t)

  (setq lsp-bridge-get-multi-lang-server-by-project
        (lambda (project-path filepath)
          ;; If typescript file include deno.land url, then use Deno LSP server.
          (save-excursion
            (when (string-equal (file-name-extension filepath) "ts")
              (dolist (buf (buffer-list))
                (when (string-equal (buffer-file-name buf) filepath)
                  (with-current-buffer buf
                    (goto-char (point-min))
                    (when (search-forward-regexp (regexp-quote "from \"https://deno.land") nil t)
                      (return "deno")))))))))

  (global-set-key (kbd "C-c l f") 'lsp-bridge-find-def)
  (global-set-key (kbd "C-c l F") 'lsp-bridge-find-def-other-window)
  (global-set-key (kbd "C-c l r") 'lsp-bridge-find-def-return)
  (global-set-key (kbd "C-c l R") 'lsp-bridge-find-find-references)

  (provide 'init-lsp-bridge)
#+end_src
* mail
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-mail.el
:END:

** account
#+begin_src elisp
  ;; (require 'private)
  (setq user-mail-address "hello@kazurezheng.xyz")

  (setq smtpmail-smtp-server "smtppro.zoho.com"
        smtpmail-smtp-service 465
        smtpmail-stream-type 'ssl
        ;; smtpmail-stream-type 'starttls
        )

  (setq send-mail-function 'smtpmail-send-it)
  ;; (setq mail-user-agent 'sendmail-user-agent)
  (setq mail-user-agent 'mu4e-user-agent)
  (setq mu4e-compose-in-reply-to-function #'mu4e-compose-in-reply-to-function)
#+end_src

** mu4e
#+begin_src elisp
  ;; (add-to-list 'load-path "~/.emacs.d/lib/mu4e/mu4e")
  (require 'mu4e)

  (setq mu4e-notification-support t)
  (setq mu4e-eldoc-support t)

  (global-set-key (kbd "C-c n C") 'mu4e-org-store-and-capture)
  ;; Show images
  (setq mu4e-show-images t)

  ;; Use fancy chars
  (setq mu4e-use-fancy-chars t)

  ;; This is set to 't' to avoid mail syncing issues when using mbsync
  (setq mu4e-change-filenames-when-moving t)

  ;; Refresh mail using isync every 10 minutes
  (setq mu4e-update-interval (* 10 60))
  (setq mu4e-get-mail-command "mbsync -a")
  (setq mu4e-maildir "~/Mail")

  (setq mu4e-drafts-folder "/Drafts")
  (setq mu4e-sent-folder   "/Sent")
  (setq mu4e-refile-folder "/Archive")
  (setq mu4e-trash-folder  "/Trash")

  ;; (setq mu4e-maildir-shortcuts
  ;;       '(("/Inbox"             . ?i)
  ;;         ("/[Gmail]/Sent Mail" . ?s)
  ;;         ("/[Gmail]/Trash"     . ?t)
  ;;         ("/[Gmail]/Drafts"    . ?d)
  ;;         ("/[Gmail]/All Mail"  . ?a)))

  (setq mu4e-get-mail-command "mbsync -a")  ; or offlineimap, isync, etc.
  (setq mu4e-update-interval 300)  ; Update every 5 minutes
  (global-set-key  (kbd "C-c o m") 'mu4e)
#+end_src
** edbd
#+begin_src emacs-lisp
  ;; (add-hook 'message-mode-hook
  ;;           '(lambda ()
  ;;              (flyspell-mode t)
  ;;              (local-set-key (kbd "TAB") 'bbdb-complete-name)))

  ;; (add-to-list 'load-path "/where/you/place/bbdb/")
  ;; (require 'bbdb)
  ;; (bbdb-initialize 'message 'gnus 'sendmail)
  ;; (add-hook 'gnus-startup-hook 'bbdb-insinuate-gnus)
  ;; (setq bbdb/mail-auto-create-p t
  ;;       bbdb/news-auto-create-p t)

  (require 'ebdb)
  (require 'ebdb-mu4e)
  (require 'ebdb-complete)

  (ebdb-complete-enable)

  (defun kz/ebdb-set-mail-from-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^From:.*" nil t)
            (replace-match (format "From: %s" str)))))))

  (defun kz/ebdb-set-mail-to-address (&optional records arg kill)
    (interactive (list (ebdb-prompt-for-record)
  		     current-prefix-arg))
    (let ((recs (if (listp records) records (list records)))
  	(style (if arg 'list 'inline))
  	usable str m)
      (dolist (r recs)
        (when (setq m (ebdb-record-mail r))
  	(push (cons r (or (object-assoc 'primary 'priority m)
  			  (car m)))
  	      usable)))
      (setq str (ebdb-records-cite style usable))
      (if kill
  	(progn
  	  (kill-new str)
  	  (message "Citation added to kill ring"))
        (save-excursion
          (goto-char (point-min))
          (when (re-search-forward "^To:.*" nil t)
            (replace-match (format "To: %s" str)))))))

  (define-key message-mode-map (kbd "C-c e f") 'kz/ebdb-set-mail-from-address)
  (define-key message-mode-map (kbd "C-c e t") 'kz/ebdb-set-mail-to-address)
#+end_src

* COMMENT wish list
** desktop
#+begin_src emacs-lisp
  (setq desktop-load-locked-desktop t) ; don't popup dialog ask user, load anyway
  (setq desktop-restore-frames nil)    ; don't restore any frame

  (desktop-save-mode 1)
#+end_src
** web mode
- typecript-mode
- php-mode
- prettier
** ui

#+begin_src emacs-lisp
  (setq frame-inhibit-implied-resize t
      frame-resize-pixelwise t)
  (setq initial-frame-alist '((top . 0.5)
                              (left . 0.5)
                              (width . 0.7)
                              (height . 0.85)
                              (fullscreen)))
#+end_src
** TODO read-only-mode
#+begin_src emacs-lisp :tangle no
  (defvar easy-nav-mode-map
    (let ((map (make-sparse-keymap)))
      ;; 用 n 和 p 来导航
      (define-key map (kbd "n") #'next-line)
      (define-key map (kbd "p") #'previous-line)
      (define-key map (kbd "b") #'backward-char)
      (define-key map (kbd "f") #'forward-char)

      (define-key map (kbd "M-f") #'forward-word)
      (define-key map (kbd "M-b") #'backward-word)

      (define-key map (kbd "a") #'beginning-of-line)
      (define-key map (kbd "e") #'end-of-line)

      (define-key map (kbd "y") #'yank)
      (define-key map (kbd "w") #'kill-ring-save)

      (define-key map (kbd "SPC") #'set-mark-command)

      (define-key map (kbd "q") #'my/read-only-mode)
      map)
    "Keymap for `easy-nav-mode'.")


  (define-minor-mode easy-nav-mode
    "Minor mode for Vi-style navigation in read-only buffers."
    :lighter " Easy-Nav"
    :keymap easy-nav-mode-map
    :global nil
    ;; 使用 (if easy-nav-mode ...) 逻辑来决定如何处理
    (if easy-nav-mode
        (message "Easy-Nav mode enabled.")
      (message "Easy-Nav mode disabled.")))

  (defun my/read-only-mode (arg)
    "Toggle read-only-mode, and sync it with `easy-nav-mode'."
    (interactive)
    ;; 直接检查 buffer-read-only 变量的值
    (if buffer-read-only
        ;; 如果当前是只读模式，则关闭它和 easy-nav-mode
        (progn
          (read-only-mode nil)
          (easy-nav-mode nil))
      ;; 否则，打开只读模式和 easy-nav-mode
      (progn
        (read-only-mode t)
        (easy-nav-mode t))))

  ;; 替换默认的 C-x C-q 绑定，使其调用你的函数
  (global-set-key (kbd "C-x C-q") #'my/read-only-mode)
#+end_src
** latex
https://abode.karthinks.com/org-latex-preview/

** vertico
#+begin_src elisp :tangle nil
  (add-to-list 'load-path "~/.emacs.d/lib/vertico/extensions")
  (require 'vertico)
  (require 'vertico-buffer)
  (require 'vertico-directory)
  (require 'vertico-flat)
  (require 'vertico-grid)
  (require 'vertico-indexed)
  (require 'vertico-mouse)
  (require 'vertico-multiform)
  (require 'vertico-quick)
  (require 'vertico-repeat)
  (require 'vertico-reverse)
  (require 'vertico-sort)
  (require 'vertico-suspend)
  (require 'vertico-unobtrusive)
  
  (require 'vertico-posframe)

  ;; (vertico-scroll-margin 0) ;; Different scroll margin
  ;; (vertico-count 20) ;; Show more candidates
  ;; (vertico-resize t) ;; Grow and shrink the Vertico minibuffer
  ;; (vertico-cycle t) ;; Enable cycling for `vertico-next/previous'
  (setq vertico-count 15)
  (vertico-mode)
  ;; (add-hook 'after-init-hook #'vertico-mode)
  ;; (add-hook 'rfn-eshadow-update-overlay #'vertico-directory-tidy)

  (setq vertico-multiform-commands
        '((consult-line (:not posframe))
          (t posframe)))
  (setq vertico-posframe-poshandler
        #'posframe-poshandler-frame-center-near-bottom)
  (setq vertico-posframe-parameters
        '((left-fringe . 8)
          (right-fringe . 8)))
  (add-hook 'vertico-mode-hook #'vertico-posframe-mode)

  ;; ;; Persist history over Emacs restarts. Vertico sorts by history position.
  ;; (use-package savehist
  ;;   :init
  ;;   (savehist-mode))

  (setq context-menu-mode t
        enable-recursive-minibuffers t
        read-extended-command-predicate #'command-completion-default-include-p)
  (setq minibuffer-prompt-properties
        '(read-only t cursor-intangible t face minibuffer-prompt))
#+end_src
** consult
#+begin_src elisp :tangle nil
  (require 'consult)
  (require 'consult-compile)
  (require 'consult-flymake)
  (require 'consult-imenu)
  (require 'consult-info)
  (require 'consult-kmacro)
  (require 'consult-org)
  (require 'consult-register)
  (require 'consult-xref)



  (setq register-preview-delay 0.5
        register-preview-function #'consult-register-format)

  (advice-add #'register-preview :override #'consult-register-window)

  (with-eval-after-load 'xref
    (setq xref-show-xrefs-function #'consult-xref
          xref-show-definitions-function #'consult-xref))

  ;; :config part of Consult (executed after package is loaded)
  (setq consult-preview-key nil)
  (consult-customize
   consult-line consult-line-multi :preview-key 'any
   consult-buffer consult-recent-file consult-theme :preview-key '(:debounce 1.0 any)
   consult-goto-line :preview-key '(:debounce 0.5 any)
   consult-ripgrep consult-git-grep consult-grep
   :initial (selected-region-or-symbol-at-point)
   :preview-key '(:debounce 0.5 any))

  (setq consult-narrow-key "<") ;; "C-+"

  (define-key consult-narrow-map (vconcat consult-narrow-key "?") #'consult-narrow-help)


  ;; CONSULT Keybindings (Global and Mode-Specific)
  (global-set-key (kbd "C-c M-x") #'consult-mode-command)
  (global-set-key (kbd "C-c h") #'consult-history)
  (global-set-key (kbd "C-c k") #'consult-kmacro)
  ;; (global-set-key (kbd "C-c m") #'consult-man)
  (global-set-key (kbd "C-c i") #'consult-info)

  (global-set-key (kbd "C-x M-:") #'consult-complex-command)
  (global-set-key (kbd "C-x b") #'consult-buffer)
  ;; (global-set-key (kbd "C-x 4 b") #'consult-buffer-other-window)
  ;; (global-set-key (kbd "C-x 5 b") #'consult-buffer-other-frame)
  (global-set-key (kbd "C-x t b") #'consult-buffer-other-tab)
  (global-set-key (kbd "C-x r b") #'consult-bookmark)
  (global-set-key (kbd "C-x p b") #'consult-project-buffer)

  (global-set-key (kbd "M-#") #'consult-register-load)
  (global-set-key (kbd "M-'") #'consult-register-store)
  (global-set-key (kbd "C-M-#") #'consult-register)
  (global-set-key (kbd "M-y") #'consult-yank-pop)

  (global-set-key (kbd "M-g e") #'consult-compile-error)
  (global-set-key (kbd "M-g f") #'consult-flymake)
  (global-set-key (kbd "M-g g") #'consult-goto-line)
  (global-set-key (kbd "M-g M-g") #'consult-goto-line)
  (global-set-key (kbd "M-g o") #'consult-outline)
  (global-set-key (kbd "M-g m") #'consult-mark)
  (global-set-key (kbd "M-g k") #'consult-global-mark)
  (global-set-key (kbd "M-g i") #'consult-imenu)
  (global-set-key (kbd "M-g I") #'consult-imenu-multi)

  (global-set-key (kbd "M-s d") #'consult-find)
  (global-set-key (kbd "M-s c") #'consult-locate)
  (global-set-key (kbd "M-s g") #'consult-grep)
  (global-set-key (kbd "M-s G") #'consult-git-grep)
  (global-set-key (kbd "M-s r") #'consult-ripgrep)
  (global-set-key (kbd "M-s l") #'consult-line)
  (global-set-key (kbd "M-s L") #'consult-line-multi)
  (global-set-key (kbd "M-s k") #'consult-keep-lines)
  (global-set-key (kbd "M-s u") #'consult-focus-lines)
  (global-set-key (kbd "M-s e") #'consult-isearch-history)

  ;; Remaps
  (global-set-key [remap Info-search] #'consult-info)
  (global-set-key [remap isearch-forward] #'consult-line)
  (global-set-key [remap recentf-open-files] #'consult-recent-file)

  ;; ;; Isearch integration
  ;; (with-eval-after-load 'isearch
  ;;   (define-key isearch-mode-map (kbd "M-e") #'consult-isearch-history)
  ;;   (define-key isearch-mode-map (kbd "M-s e") #'consult-isearch-history)
  ;;   (define-key isearch-mode-map (kbd "M-s l") #'consult-line)
  ;;   (define-key isearch-mode-map (kbd "M-s L") #'consult-line-multi))

  ;; ;; Minibuffer history
  ;; (with-eval-after-load 'minibuffer
  ;;   (define-key minibuffer-local-map (kbd "M-s") #'consult-history)
  ;;   (define-key minibuffer-local-map (kbd "M-r") #'consult-history))

  ;; Hook
  (add-hook 'completion-list-mode #'consult-preview-at-point-mode)
  ;; (global-set-key (kbd "M-g s") #'consult-flyspell)
  ;; (global-set-key (kbd "M-g y") #'consult-yasnippet)

#+end_src
** embark
#+begin_src elisp :tangle nil
  (setq prefix-help-command #'embark-prefix-help-command)

  ;; :config part of Embark
  (add-to-list 'display-buffer-alist
               '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                 nil
                 (window-parameters (mode-line-format . none))))

  (with-no-warnings
    (with-eval-after-load 'which-key
      (defun embark-which-key-indicator ()
        "An embark indicator that displays keymaps using which-key.
  The which-key help message will show the type and value of the
  current target followed by an ellipsis if there are further
  targets."
        (lambda (&optional keymap targets prefix)
          (if (null keymap)
              (which-key--hide-popup-ignore-command)
            (which-key--show-keymap
             (if (eq (plist-get (car targets) :type) 'embark-become)
                 "Become"
               (format "Act on %s '%s'%s"
                       (plist-get (car targets) :type)
                       (embark--truncate-target (plist-get (car targets) :target))
                       (if (cdr targets) "…" "")))
             (if prefix
                 (pcase (lookup-key keymap prefix 'accept-default)
                   ((and (pred keymapp) km) km)
                   (_ (key-binding prefix 'accept-default)))
               keymap)
             nil nil t (lambda (binding)
                         (not (string-suffix-p "-argument" (cdr binding))))))))

      (setq embark-indicators
            '(embark-which-key-indicator
              embark-highlight-indicator
              embark-isearch-highlight-indicator))

      (defun embark-hide-which-key-indicator (fn &rest args)
        "Hide the which-key indicator immediately when using the completing-read prompter."
        (which-key--hide-popup-ignore-command)
        (let ((embark-indicators
               (remq #'embark-which-key-indicator embark-indicators)))
          (apply fn args)))

      (advice-add #'embark-completing-read-prompter
                  :around #'embark-hide-which-key-indicator)))

  ;; EMBARK Keybindings
  (global-set-key [remap describe-bindings] #'embark-bindings)
  ;; (with-eval-after-load 'minibuffer
  ;;   (define-key minibuffer-mode-map (kbd "C-c C-o") #'embark-export))
  (add-hook 'embark-collect-mode #'consult-preview-at-point-mode)

#+end_src
** plantuml mode
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-plantuml-mode.el
:END:

#+begin_src emacs-lisp
  (require 'plantuml-mode)

  (setq plantuml-jar-path "/usr/share/plantuml/plantuml.jar")
  ;; Enable plantuml-mode for PlantUML files
  (add-to-list 'auto-mode-alist '("\\.plantuml\\'" . plantuml-mode))

  (add-to-list
    'org-src-lang-modes '("plantuml" . plantuml))

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((plantuml . t)))
  (setq org-plantuml-jar-path "/usr/share/plantuml/plantuml.jar")

  (provide 'init-plantuml-mode)
#+end_src

** treemacs
#+begin_src elisp :tangle no
  (require 'treemacs-autoloads)
  (add-to-list 'load-path (expand-file-name "lib/treemacs/src/elisp" user-emacs-directory))
  (add-to-list 'load-path (expand-file-name "lib/treemacs/src/extra" user-emacs-directory))

  (require 'treemacs-annotations)
  (require 'treemacs-async)
  (require 'treemacs-bookmarks)
  (require 'treemacs-compatibility)
  (require 'treemacs-core-utils)
  (require 'treemacs-customization)
  (require 'treemacs-dom)
  (require 'treemacs)
  (require 'treemacs-extensions)
  (require 'treemacs-faces)
  (require 'treemacs-file-management)
  (require 'treemacs-filewatch-mode)
  (require 'treemacs-follow-mode)
  (require 'treemacs-fringe-indicator)
  (require 'treemacs-git-commit-diff-mode)
  (require 'treemacs-header-line)
  (require 'treemacs-hydras)
  (require 'treemacs-icons)
  (require 'treemacs-interface)
  (require 'treemacs-logging)
  (require 'treemacs-macros)
  (require 'treemacs-mode)
  (require 'treemacs-mouse-interface)
  (require 'treemacs-peek-mode)
  (require 'treemacs-persistence)
  (require 'treemacs-project-follow-mode)
  (require 'treemacs-rendering)
  (require 'treemacs-scope)
  (require 'treemacs-tag-follow-mode)
  (require 'treemacs-tags)
  (require 'treemacs-themes)
  (require 'treemacs-treelib)
  (require 'treemacs-visuals)
  (require 'treemacs-workspaces)
  ;; (require 'treemacs-all-the-icons)
  ;; (require 'treemacs-evil)
  ;; (require 'treemacs-icons-dired)
  (require 'treemacs-magit)
  ;; (require 'treemacs-mu4e)
  ;; (require 'treemacs-perspective)
  ;; (require 'treemacs-persp)
  (require 'treemacs-projectile)
  (require 'treemacs-tab-bar)


  (treemacs-git-mode 'deferred)

  (setq treemacs-buffer-name-function            #'treemacs-default-buffer-name
        treemacs-buffer-name-prefix              " *Treemacs-Buffer-"
        treemacs-collapse-dirs                   (if treemacs-python-executable 3 0)
        treemacs-deferred-git-apply-delay        0.5
        treemacs-directory-name-transformer      #'identity
        treemacs-display-in-side-window          t
        treemacs-eldoc-display                   'simple
        treemacs-file-event-delay                2000
        treemacs-file-extension-regex            treemacs-last-period-regex-value
        treemacs-file-follow-delay               0.2
        treemacs-file-name-transformer           #'identity
        treemacs-follow-after-init               t
        treemacs-expand-after-init               t
        treemacs-find-workspace-method           'find-for-file-or-pick-first
        treemacs-git-command-pipe                ""
        treemacs-goto-tag-strategy               'refetch-index
        treemacs-header-scroll-indicators        '(nil . "^^^^^^")
        treemacs-hide-dot-git-directory          t
        treemacs-indentation                     1
        treemacs-indentation-string              " "
        treemacs-is-never-other-window           nil
        treemacs-max-git-entries                 5000
        treemacs-missing-project-action          'ask
        treemacs-move-files-by-mouse-dragging    t
        treemacs-move-forward-on-expand          nil
        treemacs-no-png-images                   nil
        treemacs-no-delete-other-windows         t
        treemacs-project-follow-cleanup          nil
        treemacs-persist-file                    (expand-file-name ".cache/treemacs-persist" user-emacs-directory)
        treemacs-position                        'left
        treemacs-read-string-input               'from-child-frame
        treemacs-recenter-distance               0.1
        treemacs-recenter-after-file-follow      nil
        treemacs-recenter-after-tag-follow       nil
        treemacs-recenter-after-project-jump     'always
        treemacs-recenter-after-project-expand   'on-distance
        treemacs-litter-directories              '("/node_modules" "/.venv" "/.cask")
        treemacs-project-follow-into-home        nil
        treemacs-show-cursor                     nil
        treemacs-show-hidden-files               t
        treemacs-silent-filewatch                nil
        treemacs-silent-refresh                  nil
        treemacs-sorting                         'alphabetic-asc
        treemacs-select-when-already-in-treemacs 'move-back
        treemacs-space-between-root-nodes        t
        treemacs-tag-follow-cleanup              t
        treemacs-tag-follow-delay                1.5
        treemacs-text-scale                      0.1
        treemacs-user-mode-line-format           nil
        treemacs-user-header-line-format         nil
        treemacs-wide-toggle-width               70
        treemacs-width                           25
        treemacs-width-increment                 1
        treemacs-width-is-initially-locked       t
        treemacs-workspace-switch-cleanup        nil)

  (treemacs-resize-icons 10)
  (treemacs-follow-mode t)
  (treemacs-filewatch-mode t)
  (treemacs-fringe-indicator-mode 'always)
  (when treemacs-python-executable
    (treemacs-git-commit-diff-mode t))
  (treemacs-hide-gitignored-files-mode nil)

  (define-key global-map (kbd "C-c o s") 'treemacs-select-window)
#+end_src

** whitespace
#+begin_src emacs-lisp :tangle no
  (require 'whitespace-cleanup-mode)

  (dolist (hook (list
                 'prog-mode-hook
                 'org-mode-hook))
    (add-hook hook 'whitespace-cleanup-mode))

  (dolist (hook (list
                 'prog-mode-hook
                 ))
    (add-hook hook 'whitespace-mode))

  (setq whitespace-style '(face trailing blanks))
#+end_src
** pdf-tools
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-pdf-tools.el
:END:

#+begin_src emacs-lisp
  (add-to-list 'load-path "~/.emacs.d/lib/tablist")
  (require 'tablist)
  (require 'pdf-tools)

  (require 'pdf-occur)
  (require 'pdf-history)
  (require 'pdf-links)
  (require 'pdf-outline)
  (require 'pdf-annot)
  (require 'pdf-sync)

  (require 'image-roll)
  (require 'pdf-cache)
  (require 'pdf-dev)
  (require 'pdf-history)
  (require 'pdf-info)
  (require 'pdf-isearch)
  (require 'pdf-loader)
  (require 'pdf-macs)
  (require 'pdf-misc)
  (require 'pdf-occur)
  (require 'pdf-outline)
  (require 'pdf-roll)
  (require 'pdf-util)
  (require 'pdf-view)
  (require 'pdf-virtual)

  (pdf-tools-install)
  (pdf-loader-install)

  ;; (add-hook 'pdf-view-mode-hook 'pdf-view-fit-width-to-window)
  (add-hook 'pdf-view-mode-hook 'pdf-view-roll-minor-mode)

  (setq TeX-PDF-mode t)
  (setq TeX-source-correlate-mode t)
  (setq TeX-source-correlate-method 'synctex)
  (setq TeX-source-correlate-start-server t)

  (setq TeX-view-program-selection '((output-pdf "PDF Tools")))
  (add-hook 'TeX-after-compilation-finished-functions
            #'TeX-revert-document-buffer)

  (define-key pdf-view-mode-map
              "D" 'pdf-view-next-page-command)
  (define-key pdf-view-mode-map
              "A" 'pdf-view-previous-page-command)

  ;; (define-key pdf-view-mode-map
  ;;             "s" 'pdf-view-scroll-up-or-next-page)
  ;; (define-key pdf-view-mode-map
  ;;             "w" 'pdf-view-scroll-down-or-previous-page)
  (define-key pdf-view-mode-map
              "d" 'image-forward-hscroll)
  (define-key pdf-view-mode-map
              "a" 'image-backward-hscroll)

  (define-key pdf-view-mode-map
              "s" (lambda () (interactive) (pdf-roll-scroll-forward 25)))
  (define-key pdf-view-mode-map
              "w" (lambda () (interactive) (pdf-roll-scroll-backward 25)))

  (define-key pdf-annot-minor-mode-map (kbd "C-a a") 'pdf-annot-add-highlight-markup-annotation)
  (define-key pdf-annot-minor-mode-map (kbd "C-a s") 'pdf-annot-add-squiggly-markup-annotation)
  (define-key pdf-annot-minor-mode-map (kbd "C-a u") 'pdf-annot-add-underline-markup-annotation)
  (define-key pdf-annot-minor-mode-map (kbd "C-a d") 'pdf-annot-delete)

  (define-key pdf-history-minor-mode-map "b" 'pdf-history-backward)

  (define-key pdf-view-mode-map (kbd "t") #'fanyi-dwim)
  (provide 'init-pdf-tools)
#+end_src
** pdf-view-restore
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-pdf-view-restore.el
:END:

#+begin_src emacs-lisp
  (require 'pdf-view-restore)

  (add-hook 'pdf-view-mode-hook 'pdf-view-restore-mode)
#+end_src
** org noter
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-org-noter.el
:GPTEL_TOPIC: org-noter
:END:

#+begin_src emacs-lisp
  (require 'org-noter)

  (define-key global-map (kbd "C-c n n") 'org-noter)

  (define-key org-noter-doc-mode-map (kbd "c") 'org-noter-insert-note)
  (define-key org-noter-doc-mode-map (kbd "M-c") 'org-noter-insert-precise-note)

  (defun kz/org-noter-insert-precise-note-and-id ()
    (interactive)
    (org-noter-insert-precise-note)
    (org-id-get-create))
  (defun kz/org-noter-insert-note-and-id ()
    (interactive)
    (org-noter-insert-note)
    (org-id-get-create))
  (define-key org-noter-doc-mode-map (kbd "e") 'kz/org-noter-insert-note-and-id)
  (define-key org-noter-doc-mode-map (kbd "M-e") 'kz/org-noter-insert-precise-note-and-id)

  (setq org-noter-auto-save-last-location t)
  (setq org-noter-highlight-selected-text nil)
  (setq org-noter-max-short-selected-text-length 80)

  (setq org-noter-always-create-frame nil)
  (setq org-noter-separate-notes-from-heading t)

  (provide 'init-org-noter)
#+end_src
** quickrun
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-quickrun.el
:END:

#+begin_src emacs-lisp
  (require 'quickrun)

  (define-key global-map (kbd "C-c c r") 'quickrun)

  (setq quickrun-focus-p t)
  (setq quickrun-truncate-lines t)

  ;; ;; Use this parameter as C++ default
  ;; (quickrun-add-command "c++/c1z"
  ;;   '((:command . "g++")
  ;;     (:exec    . ("%c -std=c++1z %o -o %e %s"
  ;;          "%e %a"))
  ;;     (:remove  . ("%e")))
  ;;   :default "c++")

  ;; ;; Use this parameter in pod-mode
  ;; (quickrun-add-command "pod"
  ;;   '((:command . "perldoc")
  ;;     (:exec    . "%c -T -F %s"))
  ;;   :mode 'pod-mode)

  ;; ;; You can override existing command
  ;; (quickrun-add-command "c/gcc"
  ;;   '((:exec . ("%c -std=c++1z %o -o %e %s"
  ;;           "%e %a")))
  ;;   :override t)

  (quickrun-add-command "python" ; 这是 quickrun 识别的语言名称，对应 quickrun-mode-alist 中的 entry
    '((:command . "python3")
      (:exec . ("%s %a")))
    :override t )

  (provide 'init-quickrun)
#+end_src
** COMMENT ivy-posframe
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-ivy-posframe.el
:END:

#+begin_src emacs-lisp
  (require 'ivy-posframe)
  ;; display at `ivy-posframe-style'
  ;; (setq ivy-posframe-display-functions-alist '((t . ivy-posframe-display)))
  ;; (setq ivy-posframe-display-functions-alist '((t . ivy-posframe-display-at-frame-center)))
  ;; (setq ivy-posframe-display-functions-alist '((t . ivy-posframe-display-at-window-bottom-left)))
  ;; (setq ivy-posframe-display-functions-alist '((t . ivy-posframe-display-at-frame-bottom-left)))
  ;; (setq ivy-posframe-display-functions-alist '((t . ivy-posframe-display-at-window-bottom-left)))
  ;; (setq ivy-posframe-display-functions-alist '((t . ivy-posframe-display-at-frame-top-center)))


  ;; (setq ivy-posframe-display-functions-alist
  ;;       '(
  ;;         ;; (swiper          . ivy-display-function-fallback)
  ;;         ;; (org-roam-node-find . ivy-posframe-display-at-frame-center)
  ;;         ;; (t               . ivy-posframe-display-at-window-bottom-left)
  ;;         (t . ivy-posframe-display-at-frame-center))
  ;;       )
  ;; (setq ivy-posframe-height-alist '((swiper . 10)
  ;;                                   (t      . 10)))

  (setq ivy-posframe-width nil)

  (setq ivy-posframe-parameters
        '((left-fringe . 8)
          (right-fringe . 8)))

  (setq ivy-posframe-display-functions-alist
        '((t . ivy-posframe-display-at-frame-top-center)))

  (ivy-posframe-mode 1)
  (provide 'init-ivy-posframe)
#+end_src
** ox-hugo
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-ox-hugo.el
:END:

#+begin_src emacs-lisp
  (with-eval-after-load 'ox
    (require 'ox-hugo))

  (provide 'init-ox-hugo)
#+end_src
** COMMENT olivetti
#+begin_src emacs-lisp
  (require 'olivetti)
  (define-key global-map (kbd "C-c o o") 'olivetti-mode)
#+end_src
** COMMENT everywhere
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-emacs-everywhere.el
:END:
- [ ] how to remove the file store in the ~/tmp~

#+begin_src emacs-lisp
  (require 'emacs-everywhere)

  (add-hook 'emacs-everywhere-mode-hook 'toggle-input-method)

  (provide 'init-emacs-everywhere)
#+end_src
** keycast
#+begin_src elisp
  (require 'keycast)
  (setq keycast-tab-bar-mode t)
#+end_src
** ivy
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-ivy.el
:END:
#+begin_src emacs-lisp

  (require 'ivy)
  (require 'swiper)
  (require 'counsel)
  (ivy-mode)
  (setopt ivy-use-virtual-buffers t)
  (setopt enable-recursive-minibuffers t)
  ;; Enable this if you want `swiper' to use it:
  ;; (setopt search-default-mode #'char-fold-to-regexp)
  (keymap-global-set "C-s" #'swiper-isearch)
  (keymap-global-set "C-c C-r" #'ivy-resume)
  (keymap-global-set "<f6>" #'ivy-resume)
  (keymap-global-set "M-x" #'counsel-M-x)
  (keymap-global-set "C-x C-f" #'counsel-find-file)
  (keymap-global-set "<f1> f" #'counsel-describe-function)
  (keymap-global-set "<f1> v" #'counsel-describe-variable)
  (keymap-global-set "<f1> o" #'counsel-describe-symbol)
  (keymap-global-set "<f1> l" #'counsel-find-library)
  (keymap-global-set "<f2> i" #'counsel-info-lookup-symbol)
  (keymap-global-set "<f2> u" #'counsel-unicode-char)
  (keymap-global-set "C-c g" #'counsel-git)
  (keymap-global-set "C-c j" #'counsel-git-grep)
  (keymap-global-set "C-c v" #'counsel-ag)
  (keymap-global-set "C-x l" #'counsel-locate)
  (keymap-global-set "C-S-o" #'counsel-rhythmbox)
  (keymap-global-set "M-y" #'counsel-yank-pop)
  (keymap-set minibuffer-local-map "C-r" #'counsel-minibuffer-history)

  (provide 'init-ivy)
#+end_src

** amx
#+begin_src elisp
  (require 'amx)
  (add-hook 'after-init-hook 'amx-mode)
#+end_src
** citar
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-citar.el
:END:

*** basic
#+begin_src emacs-lisp
  (require 'citar)

  (setq org-cite-global-bibliography '("~/Documents/roam/biblio.bib"))
  (setq org-cite-insert-processor 'citar
        org-cite-follow-processor 'citar
        org-cite-activate-processor 'citar)
  (setq citar-bibliography org-cite-global-bibliography)
#+end_src
*** org roam
#+begin_src emacs-lisp
  (defun jethro/org-roam-node-from-cite (keys-entries)
    (interactive (list (citar-select-ref :multiple nil :rebuild-cache t)))
    (let ((title (citar--format-entry-no-widths (cdr keys-entries)
                                                "${author editor} :: ${title}")))
      (org-roam-capture- :templates
                         '(("r" "reference" plain "%?" :if-new
                            (file+head "reference/${citekey}.org"
                                       ":PROPERTIES:\n:ROAM_REFS: [cite:@${citekey}]\n:END:\n#+title: ${title}\n")
                            :immediate-finish t
                            :unnarrowed t))
                         :info (list :citekey (car keys-entries))
                         :node (org-roam-node-create :title title)
                         :props '(:finalize find-file))))
#+end_src

*** template
#+begin_src emacs-lisp

  (setq citar-templates
        '((main . "${author editor:30%sn}     ${date year issued:4}     ${title:48}")
          (suffix . "          ${=key= id:15}    ${=type=:12}    ${tags keywords:*}")
          (preview . "${author editor:%etal} (${year issued date}) ${title}, ${journal journaltitle publisher container-title collection-title}.\n")
          (note . "Notes on ${author editor:%etal}, ${title}")))


#+end_src


*** END
#+begin_src emacs-lisp
  (provide 'init-citar)
#+end_src

** COMMENT highlight-indent-guides
#+begin_src emacs-lisp
  (require 'highlight-indent-guides)

  (setq highlight-indent-guides-method 'character)
  (setq highlight-indent-guides-auto-character-face-perc 40)
  (setq highlight-indent-guides-auto-enabled t)

  ;; (set-face-background 'highlight-indent-guides-odd-face "darkgray")
  ;; (set-face-background 'highlight-indent-guides-even-face "dimgray")
  ;; (set-face-foreground 'highlight-indent-guides-character-face "gray20")

  (add-hook 'prog-mode-hook 'highlight-indent-guides-mode)
#+end_src

** COMMENT aggressive-indent
#+begin_src elisp
  (require 'aggressive-indent)
  (global-aggressive-indent-mode 1)
  (add-to-list 'aggressive-indent-excluded-modes 'html-mode)
#+end_src
** auto save
#+begin_src elisp
  ;; (auto-save-mode +1)
  (setq auto-save-default nil)
  (auto-save-visited-mode +1)

  (defun my/save-all-unsaved ()
    (interactive)
    (save-some-buffers t))
  (setq after-focus-change-function 'my/save-all-unsaved)
  (add-hook 'find-file-hook 'my/save-all-unsaved)

#+end_src
